
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hey everyone, Ive been grappling with a question for the past year and Im ready to address it head-on with a solution. I could use some help with this issue. Lets say I have recurring events, like a garden timer that goes off every week. Picture having random events">
    <meta name="keywords" content="countdown timer code challenge, calculate time to next event, studio5000 programming, recurring event scheduler, event countdown algorithm, event scheduling solution, event timer code development">
    <meta name="author" content="oxmaint">
    
    <link rel="canonical" href="https://community.oxmaint.com/discussion-forum/countdown-timer-code-challenge-calculate-time-to-next-event-studio5000">
    <title>Countdown Timer Code Challenge: Calculate Time to Next Event, Studio5000 | Oxmaint Community</title>
    <link rel="shortcut icon" href="./../assets/img/favicon.png" />
    <link rel="stylesheet" href="./../assets/css/plugins.css" />
    <link rel="stylesheet" href="./../assets/css/style.css" />
    <link rel="stylesheet" href="./../assets/css/colors/purple.css" />
    
    <!-- og or twitter tags -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Countdown Timer Code Challenge: Calculate Time to Next Event, Studio5000 | Oxmaint Community">
    <meta property="og:description" content="Hey everyone, Ive been grappling with a question for the past year and Im ready to address it head-on with a solution. I could use some help with this issue. Lets say I have recurring events, like a garden timer that goes off every week. Picture having random events">
    <meta property="og:url" content="https://community.oxmaint.com/discussion-forum/countdown-timer-code-challenge-calculate-time-to-next-event-studio5000">
    <meta property="og:site_name" content="Oxmaint">
    <meta property="og:image" content="https://community.oxmaint.com/assets/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Countdown Timer Code Challenge: Calculate Time to Next Event, Studio5000 | Oxmaint Community">
    <meta name="twitter:description" content="Hey everyone, Ive been grappling with a question for the past year and Im ready to address it head-on with a solution. I could use some help with this issue. Lets say I have recurring events, like a garden timer that goes off every week. Picture having random events">
    <meta name="twitter:image" content="https://community.oxmaint.com/assets/img/favicon.png">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y6M0T9NLP4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-Y6M0T9NLP4');
    </script>

    <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://community.oxmaint.com/discussion-forum/countdown-timer-code-challenge-calculate-time-to-next-event-studio5000"
      },
      "headline": "Countdown Timer Code Challenge: Calculate Time to Next Event, Studio5000",
      "description": "Hey everyone, Ive been grappling with a question for the past year and Im ready to address it head-on with a solution. I could use some help with this issue. Lets say I have recurring events, like a garden timer that goes off every week. Picture having random events",
      "author": {
        "@type": "Person",
        "name": "thehoneybadger"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Oxmaint",
        "logo": {
          "@type": "ImageObject",
          "url": "https://community.oxmaint.com/assets/img/favicon.png"
        }
      },
      "datePublished": "2024-07-06",
      "image": "https://community.oxmaint.com/assets/img/favicon.png"
    }
    </script>

    

<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" defer></script>
<link rel="stylesheet" href="./../assets/css/home.css"/>
</head>
<body>
    <div class="content-wrapper bg-gray">
        <?php include "../include/header.php" ?>
        <!-- /header -->
        <div class="container my-5">
            

            <div class="bg-primary card p-4 mb-4">
                <h1 class="text-white">Countdown Timer Code Challenge: Calculate Time to Next Event, Studio5000</h1>
                <div class="d-flex justify-content-between">
                    <ul class="post-meta text-white fs-15 mb-4">
                        <li class="post-date"><i class="uil uil-calendar-alt"></i><span>06-07-2024</span></li>
                        <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
                        <li class="post-comments"><i class="uil uil-comment-alt-dots"></i><span>15 comments</span></li>
                        <li class="post-seen"><i class="uil uil-eye"></i><span id="counter">897</span></li>
                        <li class="post-like"><i class="uil uil-thumbs-up" id="likeButton"></i><span id="likeCount">194</span></li>
                    </ul>
                </div>
                <div class="card p-4">
                    <h3>Question:</h3>
                    <p>Hey everyone, I've been grappling with a question for the past year and I'm ready to address it head-on with a solution. I could use some help with this issue. Let's say I have recurring events, like a garden timer that goes off every week. Picture having random events labeled as EVENT 1 occurring every Tuesday at 23:13, EVENT 2 happening every Friday at 23:30, and the current moment labeled as NOW. My goal is to create a countdown timer from NOW to the upcoming event, in this case, EVENT 1.

Task 1: Develop a code to determine which event, EVENT 1 or EVENT 2, is the next one on the schedule.

A challenge I encounter with the countdown timer is that the events repeat weekly. For instance, if today is Saturday, the next event is on Tuesday, followed by Friday, then back to Tuesday, and so forth indefinitely.

Task 2: Design a code that calculates the time remaining between NOW and the following event.

I have a rough concept of how to approach this, but explaining it thoroughly would be time-consuming and may not be the final solution. Has anyone attempted a similar challenge before? Let's collaborate and figure this out together.</p>
                </div>
            </div>

            <div class="row custom-row">
                <div class="col-lg-9 mx-auto mb-5">
                    <div>
                        <div class="p-4">
                            <h3 class="text-primary">Top Replies</h3>
                            
        <div class="bg-white p-3 rounded mb-3">
            <p>What level of precision is required, such as within +/- 1 second? Which programming environment should be used - for example, make, model, ladder logic vs. structured text, etc.?</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>07-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>drbitboy</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>The Honeybadger is seeking assistance with a recurring event scheduling issue that has been bothering them for about a year. They are determined to tackle the problem head-on and find a solution, and would appreciate any help. The issue involves creating a countdown timer between the present moment and the next scheduled event, such as a garden timer. The goal is to identify which upcoming event is next and then count down the time until it occurs. One of the challenges faced is that the events repeat in a cyclical pattern, making it essential to accurately calculate the time until the next occurrence. While the Honeybadger has a rough idea of how to approach the problem, they are open to suggestions from others who may have dealt with similar challenges in the past. Lastly, they inquire if this task is related to homework.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>08-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>Rsflipflop256</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>User Rsflipflop256 inquired, "Is this assignment for school?" Well, rest assured, this is far from being a homework assignment. It's actually a project I've dedicated over five years to perfecting in the comfort of my own home.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>09-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>Drbitboy inquired about the required accuracy and programming environment needed for the task. The programming environment being used is Ladder Logic with RSLogix5000 on a Compactlogix 1769 L35E platform. As for accuracy, a margin of +/- 15 minutes is acceptable.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>10-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>While this may be new territory for you, calculating the total hours on a wall clock (translated into hours per month or week) and contrasting it with a specific date (converted into hours per month or week) can provide a useful figure for your countdown. This method can help you better visualize and track your progress towards the set date.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>Chris_M</span></li>
            </ul>
        </div>
        
                        </div>
                        <div class="p-4">
    <h3 class="text-primary">
        <a href="#" class="toggle-more-replies" style="text-decoration: underline; color: #1a73e8; cursor: pointer;">More Replies →</a>
    </h3>
    <div class="more-replies-content" style="display: none;">
                            
        <div class="bg-white p-3 rounded mb-3">
            <p>Determining whether events are independent or dependent is crucial. If they are independent, a sequence like e₁ e₂ e₁ e₁ e₂ will eventually occur. In such cases, start by setting two timestamps, T₁ and T₂, to the current time using unix-like timestamps. When event e₁ happens, update T₁ as T₁ := T + (T - T₁), where T represents the current time. Repeat the same process for event e₂ as well: T₂ := T + (T - T₂). Continuously compare the current time to the smaller value between T₁ and T₂. In the case of dependent events, they will always alternate. Interestingly, the method described above also applies to dependent events, making the distinction between independent and dependent events less impactful.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>Cheeseface</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>Cheeseface mentioned the significance of distinguishing between independent and dependent events. In the case of independent events, a sequence like e₁ e₂ e₁ e₁ e₂ may occur. To address this, initialize two timestamps, T₁ and T₂, to the current time using unix-like timestamps. When e₁ occurs, update T₁ as T₁ := T + (T - T₁) where T represents the current time. Apply the same logic for e₂: T₂ := T + (T - T₂). Continuously compare the current time to the smaller of T₁ and T₂. For dependent events, they will consistently alternate, making the above method applicable. Ultimately, the distinction between independent and dependent events serves as a point of discussion rather than a crucial consideration.

Hey Chris, I appreciate your input. All events are indeed independent and signify a timer start time input by the user (in this case, the gardener). Your suggestion regarding timestamps aligns with my thoughts. Figuring out how to implement this using ladder logic in a Logix5000 environment remains a challenge for me. Acquiring timestamps in Logix5000 is not a straightforward process. The reference to "unix-like timestamps" may be unfamiliar to some. Could you provide some clarification on this term?</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>Unix systems store time as a numerical value representing the number of seconds that have passed since January 1, 1970. In contrast, PLC systems have a similar setup, with a base year of 1972 and time measured in microseconds. In order to work with this data, it is recommended to use 64-bit instructions. By dividing the value by 10^6, you can convert it back to seconds, which will be represented as a 32-bit number until the year 2038. This conversion method ensures compatibility and accuracy in time tracking across different systems.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>Cheeseface</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>The Unix time system keeps track of time by counting the total number of seconds elapsed since January 1st, 1970. To retrieve the current time and date, I utilize the GSV (Get SystemValue) function, specifying the Class Name as WallClockTime, Instance Name as (Blank), Attribute Name as LocalDateTime, and Destination as YourArray[0]. Simply create a Dint Array with 7 elements to store the time and date information.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>Chris_M</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>Chris_M explained that Unix time is measured in total seconds since January 1, 1970. When needing time and date information, a GSV (Get SystemValue) Class can be utilized. The Class Name is WallClockTime, the Instance Name is left blank, the Attribute Name is LocalDateTime, and the destination is set to YourArray[0]. To implement this, simply create a Dint Array with 7 elements. Utilizing Unix time is a beneficial concept and having the GSV configured is essential for effective scheduling purposes.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>One useful feature is the ability to determine the day of the week using Logix Designer. Rockwell has provided a sample program for this purpose. To access it quickly, launch Logix Designer and select "Sample Project" from the "Open" menu on the splash screen. Navigate to the "Samples" directory and locate the DayOfWeek.L5X file to import into a new project. This method may be more convenient than converting your event time setpoint to Unix time in the PLC.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>joseph_e2</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>I previously utilized these tools for measuring time: Time Elapsed, Time Difference, and Time Reduction.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>widelto</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>While I was involved with my grandchildren, you were making progress with the "Eunuchs™" time. Are the events programmed as inputs in the PLC (XIC Local:I.0.0 => event 1 occurred on this scan cycle and will repeat at the same time next week) or are they stored as [weekday, time of day] in the system? Time measurements follow a linear and continuous progression relative to a zero epoch. Unix™ time is calculated in seconds since the Unix™ epoch of 1970-JAN-01T00:00:00, with the Logix/GSV version measured in integer microseconds since that time. The Earth's rotation is slightly slower than 86,400 atomic-timed seconds per day, necessitating a leap second adjustment roughly every third year. 

There are approximately PI x 10^7 seconds in one year, placing current Unix™ time between 1.5Gs and 2Gs. The Logix/GSV value is 64-bit and will not rollover within a relevant timeframe. If 1769-L35E belongs to the 5370 family, the 64-bit GSV values will consist of two 32-bit integers, likely signed (DINT, not UDINT). 

There are 604,800 seconds in a week, equating to 604,800,000 microseconds. By reducing the current Unix™ time modulo this number, we can determine the number of seconds since the most recent midnight between Wednesday and Thursday. Let's refer to this value as Tnow. 

When we know the day, hour, minute, and second of the next event, we can calculate the time until that event occurs in seconds, known as Tevent. By considering Tnow and Tevent, we can determine the time remaining until the next occurrence of an event, accounting for week rollovers. The PLC can convert GSV WALLCLOCKTIME.CurrentValue to Tnow each scan cycle and calculate Tremaining for each event type to display the event with the lowest remaining time. Addressing edge cases, such as the 64-bit unsigned WALLCLOCKTIME.CurrentValue composed of two 32-bit DINTs, may require specialized coding or tools like Rockwell's AOI for 64-bit math with pairs of 32-bit DINTs. Additionally, handling Daylight Savings Time adjustments can be accomplished using WALLCLOCKTIME.ApplyDST.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>drbitboy</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>I have devised a practical solution by comparing dates from a reference point. The key to this solution lies in the concept of comparing dates with a reference point. I will explain this in multiple posts as diagrams will take up a lot of space. To clarify the problem, events like Event 1 and Event 2 are scheduled on a weekly timer that repeats in a predictable manner. This HMI screen allows users to input event dates and times, selecting the days and times for each event. For instance, if you need to water your roses on Mondays, Wednesdays, and Fridays at 0100hrs and 1500hrs, you would choose the respective days and enter the times using the numeric input buttons. Don't forget to save your entries using the "Save" button, which will be discussed later. Each day can accommodate up to 4 event times. Initially, I presented a linear timeline, but I now realize I should view it more as circular, as events repeat in a sine wave pattern. Here is the updated timeline showcasing 4 scheduled events and 2 current events.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
        <div class="bg-white p-3 rounded mb-3">
            <p>The chart is divided into two sections: the top half labeled as A and the bottom half labeled as B, each representing 7 days of the week. When using this chart to compare dates, the following rules are followed:
1. An event is recorded in both halves A and B.
2. The term "NOW" can only be found in half A.
3. Sunday 0000hrs serves as the point of origin or datum.
To calculate the time stamp for any event (e.g., event 1 or "NOW" event), simply add up the number of minutes from the datum to the event time. Four scheduled events and two "NOW" events have been assigned in this example, generating a table of time stamps with a breakdown of minutes used for each calculation.
By comparing the time stamps, it is possible to determine the "next" event from a list of events by following these steps:
1. Subtract each event from "NOW".
2. Identify the calculated negative value closest to 0 as the "next" event.
To determine the time remaining until the next event from "NOW", use a simple SUB instruction on the "next" event to calculate the number of minutes remaining. Following these guidelines, it is revealed that the next event from "NOW1" is Event_2_D on Friday at 0230hrs, with "NOW1" being 2354 minutes away from the event. The following event from "NOW2" is Event_1_B on Monday at 0115hrs, with "NOW2" standing 2240 minutes away from the event.</p>
            <ul class="post-meta mb-0">
                <li class="post-date"><i class="uil uil-calendar-alt"></i><span>11-07-2024</span></li>
                <li class="post-author"><i class="uil uil-user"></i><span>thehoneybadger</span></li>
            </ul>
        </div>
        
                        </div>
                    <div class="no-replies-message" style="display: none; color: gray;">
        No More Replies.
    </div>
        
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 outer-container">
        <!-- Related Topics -->
    <?php include "./related-topic.php" ?>
    </div>
            </div>
             <!-- cta button -->
        <?php include "./cta.php" ?>

            <!-- FAQ Section -->
            <div class='my-5'><h3 class='faq-title text-primary mb-4'>Frequently Asked Questions (FAQ)</h3>
<div class='faq-item bg-light p-4 rounded shadow-sm mb-3'>
<h4 class='text-dark'>FAQ: 1.  How can I determine which event is the next one on the schedule in a recurring event scenario?</h4>
<p class='text-muted'><strong>Answer:</strong> Answer: To determine the next event in a recurring event scenario, you can compare the current date and time with the scheduled times of the events to identify the upcoming event.</p>
</div>
<div class='faq-item bg-light p-4 rounded shadow-sm mb-3'>
<h4 class='text-dark'>FAQ: 2.  How can I calculate the time remaining between the current moment and the next scheduled event?</h4>
<p class='text-muted'><strong>Answer:</strong> Answer: You can calculate the time remaining between the current moment and the next event by subtracting the current timestamp from the timestamp of the next event, taking into account the recurring nature of the events.</p>
</div>
<div class='faq-item bg-light p-4 rounded shadow-sm mb-3'>
<h4 class='text-dark'>FAQ: 3.  How can I create a countdown timer from the current moment to the upcoming event?</h4>
<p class='text-muted'><strong>Answer:</strong> Answer: To create a countdown timer from the current moment to the upcoming event, you can calculate the difference in time between the current moment and the scheduled time of the next event, then display this countdown in a user-friendly format.</p>
</div>
</div>
        </div>
        <?php include "./footer-banner.php" ?>

        <!-- /footer -->
        <?php include "../include/footer.php" ?>

        <!-- Lazy load for faster image loading -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const lazyImages = document.querySelectorAll('img[loading="lazy"]');
                lazyImages.forEach(img => {
                    img.src = img.dataset.src;
                });
            });
        </script>

        <script src="like-view-counter.js"></script>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    function initializeToggleFunctionality() {
        const toggleLink = document.querySelector(".toggle-more-replies");
        const moreRepliesContent = document.querySelector(".more-replies-content");
        const noRepliesMessage = document.querySelector(".no-replies-message");

        if (!toggleLink || !moreRepliesContent || !noRepliesMessage) {
            console.error("Required elements not found. Ensure the correct class names are used.");
            console.log({
                toggleLink,
                moreRepliesContent,
                noRepliesMessage,
            });
            return;
        }

        const hasReplies = Array.from(moreRepliesContent.children).some(
            (child) => child.nodeType === Node.ELEMENT_NODE
        );

        if (hasReplies) {
            noRepliesMessage.style.display = "none";
        } else {
            noRepliesMessage.style.display = "block";
            toggleLink.style.display = "none";
            return;
        }

        toggleLink.addEventListener("click", (event) => {
            event.preventDefault();
            const isHidden = getComputedStyle(moreRepliesContent).display === "none";
            moreRepliesContent.style.display = isHidden ? "block" : "none";
            toggleLink.textContent = isHidden ? "Hide More Replies" : "More Replies →";
        });
    }

    initializeToggleFunctionality();

    const observer = new MutationObserver(() => {
        const toggleLink = document.querySelector(".toggle-more-replies");
        const moreRepliesContent = document.querySelector(".more-replies-content");

        if (toggleLink && moreRepliesContent) {
            initializeToggleFunctionality();
            observer.disconnect();
        }
    });

    observer.observe(document.body, { childList: true, subtree: true });
});
</script>
</body>
</html>
